<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castle Financial Services - Customer View</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">
                    <i class="fas fa-landmark"></i> Castle
                </div>
                <ul class="nav-menu">
                    <li><a href="/">Home</a></li>
                    <li><a href="/apply">Apply Now</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/customer" class="active">Loan Status</a></li>
                </ul>
                <div class="nav-buttons">
                    <div th:if="${username}" class="user-info">
                        <span class="welcome-text">Welcome, <strong th:text="${username}"></strong></span>
                        <!-- Show admin buttons only if user is admin -->
                        <div th:if="${role == 'ADMIN'}" class="admin-buttons">
                            <a href="/admin/dashboard" class="btn btn-primary">Admin Panel</a>
                        </div>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-outline">Logout</button>
                        </form>
                    </div>
                </div>
                <div class="mobile-toggle">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
    </nav>

    <!-- Customer Loan Status Section -->
    <section class="status-section">
        <div class="container">
            <div class="section-header">
                <h2>Check Your Loan Status</h2>
                <p>Enter your registered phone number to see your latest loan application status.</p>
            </div>

            <div class="status-card">
                <form th:action="@{/customer}" method="get" class="status-form">
                    <div class="form-group">
                        <label for="phone">Registered Phone Number</label>
                <input type="text"
                id="phone"
                name="phone"
                th:value="${searchPhone}"
                placeholder="Enter 10 digit phone number"
                inputmode="numeric"
                maxlength="10"
                pattern="[0-9]{10}"
                oninput="this.value=this.value.replace(/[^0-9]/g,''); 
                if(this.value.length > 10) this.value = this.value.slice(0,10);"
                required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Check Status
                    </button>
                </form>
            </div>

            <div class="status-result" th:if="${searchPhone}">

                <!-- ðŸ”¥ ADD THIS HERE -->
                <div th:if="${error}" class="no-result">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3 th:text="${error}"></h3>
                </div>
            
                <div th:if="${application}">
                    <div class="status-summary">
                        <h3>Application Found</h3>
                        <p><strong>Applicant:</strong> <span th:text="${application.fullName}">John Doe</span></p>
                        <p><strong>Email:</strong> <span th:text="${application.email}">john@example.com</span></p>
                        <p><strong>Loan Type:</strong> <span th:text="${application.loanType}">Personal Loan</span></p>
                        <p><strong>Loan Amount:</strong>
                            <span th:text="'â‚¹' + ${#numbers.formatDecimal(application.loanAmount, 1, 2)}">â‚¹50,000</span>
                        </p>
                        <p><strong>Employment:</strong> <span th:text="${application.employmentStatus}">Salaried</span></p>
                        <p><strong>Monthly Income:</strong>
                            <span th:text="'â‚¹' + ${#numbers.formatDecimal(application.monthlyIncome, 1, 2)}">â‚¹0</span>
                        </p>
                        <p><strong>Current Status:</strong>
                            <span th:class="'status-badge status-' + ${application.status?.toLowerCase()}"
                                  th:text="${application.status}">PENDING</span>
                        </p>
                        <p><strong>Applied On:</strong>
                            <span th:text="${application.applicationDate != null ?
                                            #temporals.format(application.applicationDate, 'dd-MM-yyyy HH:mm')
                                            : 'N/A'}">
                                20-02-2026 10:30
                            </span>
                        </p>
                        <p th:if="${application.adminReply}">
                            <strong>Message from Bank:</strong>
                            <span th:text="${application.adminReply}">Your loan is under review...</span>
                        </p>
                    </div>
                </div>

                <div class="no-result" th:unless="${application}">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Please enter valid no.</h3>
                    <p>No loan application found for this phone number.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Castle Financial Services</h3>
                    <p>Your trusted partner for financial solutions</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/loan-types">Loan Types</a></li>
                        <li><a href="/apply">Apply Now</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-envelope"></i> info@castle.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Castle Financial Services. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script th:src="@{/js/main.js}"></script>

    <style>
        .status-section {
            padding: 80px 0;
            background: #f8fafc;
            min-height: 100vh;
        }

        .status-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            max-width: 600px;
            margin: 0 auto 32px;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
            border: 1px solid #e2e8f0;
        }

        .status-form .form-group {
            margin-bottom: 16px;
        }

        .status-form label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #0f172a;
        }

        .status-form input {
            width: 100%;
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid #cbd5f1;
            font-size: 1rem;
        }

        .status-result {
            max-width: 700px;
            margin: 0 auto;
        }

        .status-summary {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
            border: 1px solid #e2e8f0;
        }

        .status-summary p {
            margin: 8px 0;
            color: #334155;
        }

        .no-result {
            text-align: center;
            padding: 32px 24px;
            background: #fff7ed;
            color: #c05621;
            border-radius: 16px;
            border: 1px solid #fed7aa;
        }

        .no-result i {
            font-size: 2rem;
            margin-bottom: 8px;
        }
    </style>
</body>
</html>